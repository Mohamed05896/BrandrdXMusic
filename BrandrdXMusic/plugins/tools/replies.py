import asyncio
import random
import re
import time
from pyrogram import filters, enums
from pyrogram.types import (
    InlineKeyboardMarkup, 
    InlineKeyboardButton, 
    Message, 
    CallbackQuery, 
    InlineQuery, 
    InlineQueryResultArticle, 
    InputTextMessageContent
)
from BrandrdXMusic import app
from BrandrdXMusic.misc import SUDOERS

# --- [ ูุฎุฒู ุงูุจูุงูุงุช ุงูุฐูู ] ---
db = {
    "replies": {}, 
    "personal": {}, 
    "inline": {}, 
    "special": {}, 
    "multi": {}, 
    "whispers": {},
    "stats": {"total_replies": 0, "total_whispers": 0}
}

# --- [ ุฃุฑุดูู ุงูุนุจุงุฑุงุช ุงูุนููุงู - ุฃูุซุฑ ูู 100 ุนุจุงุฑุฉ ] ---
BODA_QUOTES = [
    "ุฎูุจุฉ ุงูุฃูู ูู ุงูุดุฎุต ุงูุฐู ุธููุงู ูุฎุจุฃูุงุ ูู ุฃุจุดุน ุดุนูุฑ ๐ค๐ฅ",
    "ูู ููู ุณูุฆููุ ููููุง ูุซููุง ูู ุงููููุจ ุงูุฎุทุฃ ๐ค๐ฅ",
    "ุงูุณููุช ููุณ ุฏุงุฆูุงู ุนูุงูุฉ ุงูุฑุถุงุ ุฃุญูุงูุงู ูููู ุนูุงูุฉ ุงูุชุนุจ ๐ค๐ฅ",
    "ุฃุตุนุจ ูุฑุงู ูู ุงูุฐู ูุง ูุชุจุนู ููุงุกุ ููุง ุญุชู ูุฏุงุน ๐ค๐ฅ",
    "ูููุจูุง ููุณุช ุณูุฏุงุกุ ููููุง ุฃูุญุฑูุช ุจูููุงุช ูุง ุชููุณู ๐ค๐ฅ",
    "ุฃุญูุงูุงู ูุฑุญู ููุณ ุญุจุงู ุจุงูุฑุญููุ ุจู ูุฃู ุงูููุงู ูู ูุนุฏ ูุณุนูุง ๐ค๐ฅ",
    "ุงูุฎูุจุฉ ูู ุฃู ุชุบูู ูุฃูุช ููุชูุฆ ุจูููุงุช ูู ุชุฌุฏ ูู ูุณูุนูุง ๐ค๐ฅ",
    "ููุง ูุญุชุงุฌ ููุท ูุดุฎุต ูุฑู ุฎูู ุตูุชูุงุ ููููุง ุจูููุง ูุญูุฏูู ๐ค๐ฅ",
    "ุฃุดุฏ ุฃููุงุน ุงููุฌุน ูู ุฃู ุชูุงู ูุฃูุช ุชุจูู ุจุญุฑูุฉ ูู ููุจู ๐ค๐ฅ",
    "ุณูุงูุงู ุนูู ูููุจ ูุฑุฃุช (ููุฏุจูุฑ ุงูุฃูุฑ) ูุชุฑูุช ูุฌุนูุง ููู ๐ค๐ฅ",
    "ุงูุญุฒู ูุง ูุบูุฑ ุงููุงุถูุ ูููู ูุฏูุฑ ูุณุชูุจูู.. ุงูุชุจู ๐ค๐ฅ",
    "ุฃุณูุฃ ูุฏุงุน ูู ุงูุฐู ุชุดุนุฑ ููู ุฃูู ูู ุชุฑุงู ูุฌุฏุฏุงู ุฃุจุฏุงู ๐ค๐ฅ",
    "ูุงููุง ูููุจู ุญูุงุฉุ ูุงูููู ูู ูููุจู ูุฌุน ๐ค๐ฅ",
    "ุชููู ุนู ููู ููุณูุ ูุงููุบุงุฏุฑ ูู ููู ูุณุชุญูู ุฃุจุฏุงู ๐ค๐ฅ",
    "ุฃุตุนุจ ุญุฒู ูู ุงูุฐู ุชุฎููู ุฎูู ุงุจุชุณุงูุฉ ุจุงูุชุฉ ๐ค๐ฅ",
    "ุงููุญุฏุฉ ูู ุฃู ุชุนูุด ูุน ุฃุดุฎุงุต ูุง ูููููู ูุบุฉ ุตูุชู ๐ค๐ฅ",
    "ููุช ุงูุฃูุงู ุชุนูุฏุ ูููุชูุง ูู ูุนุฑููู ูููุงู ๐ค๐ฅ",
    "ุงูุฐูุฑูุงุช ูู ุงูุดูุก ุงููุญูุฏ ุงูุฐู ูุจูู ุจุนุฏ ุฑุญูู ุงูุฌููุน ๐ค๐ฅ",
    "ุฃุญุชุงุฌ ูุบูุจูุจุฉ ุทูููุฉ ุชูุณููู ูู ูุง ูุฑุฑุช ุจู ูุคุฎุฑุงู ๐ค๐ฅ",
    "ูุงุฏุฆูู ุฌุฏุงูุ ููู ูููุจูุง ุถุฌูุฌ ูู ุณููุน ููุฒ ุงูุฌุจุงู ๐ค๐ฅ",
    "ูุง ุชุซู ูุซูุฑุงูุ ูุงูุฌููุน ูุฑุญููู ุนูุฏ ุงูููู ๐ค๐ฅ",
    "ูุญู ูุง ููุชุจ ููุนุฌุจ ุงููุงุณุ ูุญู ููุชุจ ูููุฑุบ ุญุฒููุง ููุท ๐ค๐ฅ",
    "ุชุนุจูุง ูู ุชูุซูู ุงูููุฉุ ููุญู ุฃุถุนู ูู ุฑูุดุฉ ูู ููุจ ุงูุฑูุญ ๐ค๐ฅ",
    "ุฃุญูุงูุงู ุงูุตูุช ูู ุงูุฑุฏ ุงููุญูุฏ ุนูู ูุณูุฉ ูู ุชุญุจ ๐ค๐ฅ",
    "ุฎุณุฑูุงูู ูุฃููู ุฃุฑุงุฏูุง ุงูุฎุณุงุฑุฉุ ูุง ุชููููุง ุงูุธุฑูู ๐ค๐ฅ",
    "ููุช ุงููุฃูู ุงููุญูุฏุ ูุงูุขู ุฃูุช ุงูุบุฑูุจ ุงูุฃูุจุฑ ๐ค๐ฅ",
    "ุณุญูุงู ููู ุฐูุฑู ุฌุนูุชูุง ูุจุชุณู ูููุงูุ ูุงูููู ุชุจูููุง ๐ค๐ฅ",
    "ูุญู ุจุญุงุฌุฉ ููู ููุณู ุฃูุฏููุง ูู ุงูุนุชูุฉุ ูุง ูู ูุตููุง ููุง ๐ค๐ฅ",
    "ุงูุชูุช ุงูุญูุงูุฉุ ูุจูููุง ูุญู ููููู ุดุชุงุช ุฃููุณูุง ๐ค๐ฅ",
    "ููููุง ูููุชู ูููููู ููุฏุฎููู ุงูุนูุดูู ูููุจููู.. ููููููููู ููู ููุจุตูุฑ ุฌูููููููู ููุนุดููู ๐ค๐ฅ",
    "ูุฅูู ูุฃููู ุงูููู ูู ุบูุฑ ุญููู.. ูุนู ููุงุกู ูู ุงูููุงู ููููู ๐ค๐ฅ",
    "ุชุนุจุชู ูู ุงูููููู ุนูู ุฑุตููู ุงูุตุจุฑู ุฃูุชุธุฑู ุงูุนุจูุฑ ๐ค๐ฅ",
    "ูุฃููู ุบุฑูุชู ูู ุจุญุฑู ูุง ูุฑู ูุงุนูู ุฃุญุฏ ๐ค๐ฅ",
    "ุฃุนุงุชุจู ูููู ููุจู ูู ูููู.. ูุฃุณุฃูู ูููู ุทุงูุนูู ุงูุฑุญูููุ ๐ค๐ฅ",
    "ููุง ููุชู ูุง ุจููู ูุจูููู ุจุงุจู.. ููุทุฑูู ูููุง ุถุงูู ุงููุคุงุฏู ๐ค๐ฅ",
    "ูุณุชู ุฃุฏุฑู ูู ููุฌุฑูุง ุฃู ูุญูู ุงูุฐููู ูุฌุฑูุง ุงูุฑูุญุ ๐ค๐ฅ",
    "ุนูู ุฑุตูู ุงูุฃูุงูู ุถุงุนุช ุฃุนูุงุฑูุง ูุจุงุกู ๐ค๐ฅ",
    "ููุณ ูู ูู ูุจุชุณู ุจุฎูุฑุ ูุฎูู ุงูุณุชุงุฑ ุญูุงูุง ูููุฒูุฉ ๐ค๐ฅ",
    "ุงูููููู ุตุจุฑุงู ูุง ูุชุจุนูู ุถููุ ูููุจุงู ูููุงู ูุง ูููุณุฑ ๐ค๐ฅ",
    "ูุฑุญู ุจุตูุชู ูุฃู ุงูุถุฌูุฌ ูู ูุนุฏ ูููุนูุง ๐ค๐ฅ",
    "ุบุตุฉู ุงูููุจู ุฃุซููู ูู ุฌุจุงูู ุงูุฃุฑุถู ุฌููุนุงู ๐ค๐ฅ",
    "ูุจุญุซ ุนู ุฃููุณูุง ูู ูุฌูู ุงูุบุฑุจุงุกุ ูุฃู ููุงูุญูุง ุณูุฑูุช ๐ค๐ฅ",
    "ูููุดูุฏ ุงููู ุฃููุง ุญุงูููุงุ ูููู ูู ููู ููุง ูุตูุจ ๐ค๐ฅ",
    "ูุฅุฐุง ุฏุฎูุชูู ุงููููุจ ูุฃุญุณููุง ุณูููุงูุงุ ูุฅู ุฎุฑุงุจูุง ููุณ ุจููููู ๐ค๐ฅ",
    "ุฃุญุจุจูุงูู ุจุตุฏูุ ูุฑุญููุง ุจุจุฑูุฏุ ูุจูููุง ูุญู ููุฒู ๐ค๐ฅ",
    "ูุง ููุชูุง ูู ููุชููุ ููุง ููุชูู ูุง ุนุฑูุชู ููู ููุงูุญู ๐ค๐ฅ",
    "ุฃุญูุงูุงู ูุญุชุงุฌ ูุฃู ูููู ูุญูุฏููุ ููุณูุน ุตูุช ุงููุณุงุฑูุง ุจูุถูุญ ๐ค๐ฅ",
    "ูุง ุชุบูุฑ ููู ุฌุนู ููุจู ููุงู ููุณูุฑุงู ููู ูุนูู ๐ค๐ฅ",
    "ูุญู ูุง ูุชุบูุฑุ ูุญู ููุท ูุจุชุนุฏ ุนู ูู ูู ูุง ููุฏูุฑ ูููุชูุง ๐ค๐ฅ",
    "ูุฏ ููุณู ูุง ููู ููุงุ ููููุง ูู ููุณู ุฃุจุฏุงู ููู ุดุนุฑูุง ๐ค๐ฅ",
    "ุงูุตุฏูุงุช ููุณุช ุฏุงุฆูุงู ุณูุจูุฉุ ุฃุญูุงูุงู ุชููุธู ูู ุบุจุงุฆู ๐ค๐ฅ",
    "ุจุนุถ ุงูุฑุญูู ูุง ูุญุชุงุฌ ูุฏุงุนุงูุ ุจู ูุญุชุงุฌ ููุจุงู ูููุงู ููุท ๐ค๐ฅ",
    "ููุจู ููุณ ููุฑูุงู ูุฃุญุฏุ ููุจู ูุทูู ููู ูุณุชุญู ุงูุจูุงุก ๐ค๐ฅ",
    "ุฃูุชูุฏ ููุณู ุงููุฏููุฉุ ุงูุชู ูุงูุช ุชุถุญู ูู ููุจูุง ๐ค๐ฅ",
    "ุบุงุฏุฑูุง ูุฃููู ูู ูููููุง ูููุงู ุฌุฒุกุงู ูู ูุจุถูุง ๐ค๐ฅ",
    "ูุง ุฃุตุนุจ ุฃู ุชุจูู ุจูุง ุฏููุนุ ูุชุตุฑุฎ ุจูุง ุตูุช ๐ค๐ฅ",
    "ูู ุฌุฑุญู ูู ููุชู ููุดูุงุกุ ุฅูุง ุฌุฑุญ ุงูุฎุฐูุงู ูุง ูุจุฑุฃ ๐ค๐ฅ",
    "ุณูุงูุงู ุนูู ุงูุฐูู ุฅุฐุง ุบุจูุง ุงูุชูุฏููุงุ ูุฅุฐุง ุจูููุง ุฃูุฑูููุง ๐ค๐ฅ",
    "ูู ุฃุนุฏ ุฃูุชูุ ุงููููุฉ ุงูุชู ูุงูุช ุชูุณุฑูู ุจุงูุฃูุณ ุฃุตุจุญุช ุชุถุญููู ุงูููู ๐ค๐ฅ",
    "ุงูุฐูู ูุญุจูู ูุง ูุฑุญูููุ ุจู ูุณูููู ูู ุบุตุงุชูุง ููุฃุจุฏ ๐ค๐ฅ",
    "ุงูุนุฒูุฉ ูู ุฃู ุชูุชุดู ุฃูู ููุช ุชููู ุงููุซูุฑ ูู ุงูุฃุตุฏูุงุก ุงููุฒูููู ๐ค๐ฅ",
    "ูุง ููุจู ุตุจุฑุงู ุนูู ูุง ูุงุชุ ูุงูููู ูุนูุถู ูุง ุงููุณุฑ ๐ค๐ฅ",
    "ูุง ุชุนุงุชุจ ุฃุญุฏุงูุ ูู ุฃุฑุงุฏู ุณูุฎูู ูู ุงูุนุฏูู ุณุจุจุงู ููุจูุงุก ๐ค๐ฅ",
    "ุจููู ูุจููู ุฃููู ุบุตุฉูุ ูุฃููู ุณุคุงูู ุจูุง ุฌูุงุจ ๐ค๐ฅ",
    "ุฃูู ูุฐูุจ ุญูู ุชุถูู ุจูุง ุฃููุณูุงุ ๐ค๐ฅ",
    "ููุง ุจุฎูุฑ ูุจู ุฃู ููุณุฏูุง ุงูุชุนูู ๐ค๐ฅ",
    "ูุงุชุช ุงููููุงุช ูู ุญูุฌุฑุชูุ ููู ูุนุฏ ููุงู ูุง ููุงู ๐ค๐ฅ",
    "ุณุฃุฑุญู ููุง ุฑุญูุชุ ูุจุฐุงุช ุงูุจุฑูุฏ ุงูุฐู ูุชูุชูู ุจู ๐ค๐ฅ",
    "ููุงู ูุง ููุจู ุญูููุงู ููู ูุง ูุญูู ๐ค๐ฅ",
    "ูุญูู ุงูุญุงูููู ุงูุฐูู ุงุณุชููุธูุง ุนูู ูุงุจูุณู ุงููุงูุน ๐ค๐ฅ",
    "ูู ูููุงูุ ูุงูุงููุณุงุฑ ูุง ููููู ุจูู ูุฏููู ุฃุญูุงูู ูุจูุฑุฉ ๐ค๐ฅ",
    "ุฃุนุชุฐุฑู ูููุณู ุนู ูู ูุฑุฉู ูุซูุชู ูููุง ุจูู ูุง ูุณุชุญู ๐ค๐ฅ",
    "ูู ููุชููู ุงููุฑุงูุ ูุชููู ุงูุงูุชุธุงุฑู ุจูุง ุฃูู ๐ค๐ฅ",
    "ุชุจุงู ููุฐูุฑูุงุชุ ุชูุฑูู ุจูุง ุญูู ููููู ูู ููุฉ ูุฏูุฆูุง ๐ค๐ฅ",
    "ุงูุญูุงุฉ ูุณุชูุฑุฉุ ุณูุงุกู ููุช ูุนู ุฃู ูู ุชูู ๐ค๐ฅ",
    "ุจุนุถู ุงูุตูุชู ูุจุฑูุงุกุ ูุจุนุถูู ูุฌุนู ูุง ููุญูู ๐ค๐ฅ",
    "ุงูููููู ูุง ุชุนูู ููุจู ุจูุง ููุณ ูู ๐ค๐ฅ",
    "ูุงูุช ุฃูุงูุงู ุฌูููุฉุ ููููุง ูู ุชุนูุฏ ๐ค๐ฅ",
    "ุชุนููู ุฃู ุชูุชูู ุจููุณูุ ูุงูุฌููุนู ุฑุงุญููู ๐ค๐ฅ",
    "ูุง ููุนู ุงูุงุนุชุฐุงุฑ ุจุนุฏ ุฃู ูุงุชุช ุงูุฑูุญุ ๐ค๐ฅ",
    "ุบุฑูุจู ุฃู ูุตุจุญ ุงูุดุฎุต ุงูุฐู ูุงู ูู ุดูุก.. ูุง ุดูุก ๐ค๐ฅ",
    "ูุญูู ูุง ููุณูุ ูุญูู ูุชูุงุณู ููุนูุด ๐ค๐ฅ",
    "ุฃุจูู ูุฃูู ูู ุฃุนุฏ ุฃุญุชููู ุงูุชูุซูู ุจุฃููู ุจุฎูุฑ ๐ค๐ฅ",
    "ูู ููุจู ุญุฒูู ูู ููุณู ุนูู ุฃููู ุงูุฃุฑุถู ููุงุชูุง ุฌููุนุงู ๐ค๐ฅ",
    "ูุง ุงูููุ ุฃูุฑุบ ุตุจุฑุงู ุนูู ููุจู ุญุชู ูุฒูู ุงููุฌุน ๐ค๐ฅ",
    "ุฃุญูุงูุงู ูููู ุงูุฑุญูู ูู ุฃุณูู ุฏุฑุฌุงุช ุงูููุงุก ููููุณ ๐ค๐ฅ",
    "ุดูุฑุงู ููุฎูุจุงุชุ ุฌุนูุชูุง ุฃูุซุฑ ุญููุฉ ูุฃูู ุณุฐุงุฌุฉ ๐ค๐ฅ",
    "ูู ูุญุจู ูู ูุชุฑูู ุชุจูู ูุญูุฏุงู ุฃุจุฏุงู ๐ค๐ฅ",
    "ุณูุงูู ุนูู ูู ุฌุนููุง ููุชุดู ุฃููุง ูุณูุง ุฃููููุงุชูู ๐ค๐ฅ",
    "ุณุฃุจูู ููุง ุฃูุงุ ุนุธููุงู ูู ุนููู ููุณูุ ูุญุฒููุงู ูู ููุจู ๐ค๐ฅ",
    "ุฃุตุนุจู ุงูุฃุดูุงุกู ุฃู ุชูุฏุน ุดุฎุตุงู ูุฃูุช ุชุนููู ุฃูู ูู ุชุฑุงูู ุซุงููุฉ ๐ค๐ฅ",
    "ููุชู ุฃุฎุงูู ูู ุงููุญุฏุฉุ ูุงูุขู ุฃุตุจุญุชู ุฃุฎุงูู ูู ุงูุจุดุฑ ๐ค๐ฅ",
    "ุณููุฑูู ูู ูุฐุงุ ูููู ุณูุจูู ูู ุงูููุจู ุฃุซุฑ ๐ค๐ฅ",
    "ูุง ูููุฉ ููุฌูุงู ุฅุฐุง ูุงูู ุงูููุจู ุญุทุงูุงู ๐ค๐ฅ",
    "ุฃุฑูุฏู ุฃู ุฃูุงู ุทูููุงูุ ุจูุง ุฃุญูุงูู ูุจูุง ูุฌุน ๐ค๐ฅ",
    "ููุฏ ูุจุฑูุง ุจูุง ูููู ููุนุฑู ุฃู ููุณ ูู ูู ุฑุญู ุณูุนูุฏ ๐ค๐ฅ",
    "ุงูุญูุฏ ููู ุนูู ููู ุญุงููุ ูุนูู ููู ุดุนูุฑู ูุฑูุฑ ๐ค๐ฅ"
]

# --- [ ุฏูุงู ุงููุณุงุนุฏุฉ ] ---

async def is_admin(chat_id, user_id):
    if user_id in SUDOERS: return True
    try:
        member = await app.get_chat_member(chat_id, user_id)
        return member.status in [enums.ChatMemberStatus.ADMINISTRATOR, enums.ChatMemberStatus.OWNER]
    except: return False

def get_reply_category(command_text):
    if "ูููุฒ" in command_text: return "special"
    if "ูุชุนุฏุฏ" in command_text: return "multi"
    if "ุงููุงูู" in command_text: return "inline"
    return "replies"

# --- [ 1. ูุธุงู ุฅุฏุงุฑุฉ ุงูุฑุฏูุฏ ] ---

@app.on_message(filters.command(["ุงุถู ุฑุฏ", "ุงุถู ุฑุฏ ูููุฒ", "ุงุถู ุฑุฏ ูุชุนุฏุฏ", "ุงุถู ุฑุฏ ุงููุงูู"], "") & filters.group)
async def add_reply_logic(_, m: Message):
    if not await is_admin(m.chat.id, m.from_user.id): return await m.reply_text("ุนุฐุฑุงูุ ูุฐุง ุงูุฃูุฑ ูุฎุต ุงููุดุฑููู ููุท โ")
    parts = m.text.split(None, 2)
    if len(parts) < 3: return await m.reply_text(f"ุทุฑููุฉ ุงูุฅุถุงูุฉ ุงูุตุญูุญุฉ:\n`{parts[0]} ุงููููุฉ ุงูุฑุฏ`")
    category = get_reply_category(parts[0])
    word, reply_text = parts[1], parts[2]
    if category == "multi":
        if word not in db["multi"]: db["multi"][word] = []
        db["multi"][word].append(reply_text)
    else: db[category][word] = reply_text
    db["stats"]["total_replies"] += 1
    await m.reply_text(f"ุชู ุญูุธ ุงูุฑุฏ ุจูุฌุงุญ\nโข ุงููููุฉ: {word}\nโข ุงููุณู: {parts[0]}")

@app.on_message(filters.command(["ูุณุญ ุฑุฏ", "ูุณุญ ุฑุฏ ูููุฒ", "ุญุฐู ุฑุฏ ูุชุนุฏุฏ", "ูุณุญ ุฑุฏ ุงููุงูู", "ูุณุญ ุงูุฑุฏูุฏ", "ูุณุญ ุงูุฑุฏูุฏ ุงููููุฒู", "ูุณุญ ุงูุฑุฏูุฏ ุงููุชุนุฏุฏู", "ูุณุญ ุงูุฑุฏูุฏ ุงูุงููุงูู"], "") & filters.group)
async def delete_reply_logic(_, m: Message):
    if not await is_admin(m.chat.id, m.from_user.id): return
    cmd = m.command[0]
    category = get_reply_category(cmd)
    if "ุงูุฑุฏูุฏ" in cmd:
        db[category].clear()
        return await m.reply_text(f"ุชู ุชุตููุฑ ุณุฌู {cmd}")
    if len(m.command) < 2: return await m.reply_text("ุงุฑุณู ุงููููุฉ ุงููุฑุงุฏ ุญุฐููุง ุจุนุฏ ุงูุฃูุฑ")
    word = m.command[1]
    if word in db[category]:
        del db[category][word]
        await m.reply_text(f"ุชู ุญุฐู ({word}) ูู ุณุฌูุงุช ุงูุจูุช")
    else: await m.reply_text("ูุฐู ุงููููุฉ ุบูุฑ ููุฌูุฏุฉ")

# --- [ 2. ูุธุงู ุงูุฑุฏูุฏ ุงูุดุฎุตูุฉ (ุฑุฏู) ] ---

@app.on_message(filters.command("ุงุถู ุฑุฏู", "") & filters.group)
async def add_personal_logic(_, m: Message):
    parts = m.text.split(None, 2)
    if len(parts) < 3: return await m.reply_text("ุงูุงุณุชุฎุฏุงู: `ุงุถู ุฑุฏู ุงููููุฉ ุงูุฑุฏ`")
    user_id = m.from_user.id
    word, reply_text = parts[1], parts[2]
    if user_id not in db["personal"]: db["personal"][user_id] = {}
    db["personal"][user_id][word] = reply_text
    await m.reply_text(f"ุชู ุญูุธ ุฑุฏู ุงูุดุฎุตู ูุง ุนูเขชู\nโข ุนูุฏ ูููู: {word}")

@app.on_message(filters.command(["ุฑุฏู", "ูุณุญ ุฑุฏู", "ุฑุฏูุฏ ุงูุงุนุถุงุก", "ูุณุญ ุฑุฏูุฏ ุงูุงุนุถุงุก"], "") & filters.group)
async def personal_manager_logic(_, m: Message):
    user_id = m.from_user.id
    text = m.text
    if "ูุณุญ ุฑุฏูุฏ ุงูุงุนุถุงุก" in text:
        if await is_admin(m.chat.id, user_id):
            db["personal"].clear()
            await m.reply_text("ุชู ูุณุญ ูุงูุฉ ุฑุฏูุฏ ุงูุฃุนุถุงุก")
    elif "ุฑุฏูุฏ ุงูุงุนุถุงุก" in text:
        res = "\n".join([f"โข <a href='tg://user?id={uid}'>{uid}</a>" for uid in db["personal"]])
        await m.reply_text(f"ูุงุฆูุฉ ุงูุฃุนุถุงุก ุงูุฐูู ูุฏููู ุฑุฏูุฏ:\n\n{res or 'ูุง ููุฌุฏ.'}")
    elif "ูุณุญ ุฑุฏู" in text:
        if user_id in db["personal"]:
            del db["personal"][user_id]
            await m.reply_text("ุชู ูุณุญ ุณุฌู ุฑุฏูุฏู ุจุงููุงูู")
    elif "ุฑุฏู" in text:
        if user_id in db["personal"]:
            res = "\n".join([f"โข {k}" for k in db["personal"][user_id].keys()])
            await m.reply_text(f"ุฑุฏูุฏู ุงูุดุฎุตูุฉ ุงููุณุฌูุฉ:\n\n{res}")
        else: await m.reply_text("ููุณ ูุฏูู ุฃู ุฑุฏูุฏ ูุณุฌูุฉ ุจุนุฏ")

# --- [ 3. ูุธุงู ุงูุฒุงุฌู ูุงูููุณุงุช ุงููุทูุฑ ] ---

@app.on_message(filters.command("ุฒุงุฌู", "") & filters.group)
async def zajel_pro(_, m: Message):
    active_mems = []
    async for member in app.get_chat_members(m.chat.id, limit=100):
        if not member.user.is_bot and member.user.id != m.from_user.id: active_mems.append(member.user)
    if not active_mems: return await m.reply_text("ูุง ููุฌุฏ ุฃุนุถุงุก ูุชูุงุนููู ููุฒุงุฌู ุงูุขู ๐")
    sender, receiver = m.from_user, random.choice(active_mems)
    whisper_id = f"zajel_{m.id}"
    db["whispers"][whisper_id] = {"from": sender.id, "to": receiver.id, "msg": random.choice(BODA_QUOTES), "time": time.time()}
    await m.reply_text(
        f"โข ุนูเขชู ใ {sender.mention} ใ\nโข ุนูเขชู ใ {receiver.mention} ใ\n\nโข ูุฏูููุง ููุณุฉ ุฒุงุฌู ูุดุชุฑูู ๐\nโข ูุง ุงุญุฏ ุบูุฑููุง ูุณุชุทูุน ุฑุคูุชูุง ๐ฌ",
        reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("ุฑุคูุฉ ุงูุฑุณุงูุฉ ๐", callback_data=f"open_w_{whisper_id}")]])
    )

@app.on_message(filters.command("ุงููุณูู", "") & filters.group)
async def whisper_me_pro(_, m: Message):
    sender = m.from_user
    whisper_id = f"self_{m.id}"
    quote = random.choice(BODA_QUOTES)
    db["whispers"][whisper_id] = {"from": sender.id, "to": sender.id, "msg": quote, "time": time.time()}
    
    # ุฌุนู ุดูู "ุงููุณูู" ุฒู ุงูุฒุงุฌู ุจุฒุฑ ุดูุงู
    await m.reply_text(
        f"โข ุนูเขชู ใ {sender.mention} ใ\n\nโข ุชู ุชุฎุตูุต ููุณุฉ ุฒุงุฌู ูู ูุญุฏู ๐\nโข ุงุถุบุท ุงูุฒุฑ ุจุงูุฃุณูู ูุฑุคูุฉ ูุง ูุฎููู ููุจู..",
        reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("ุฑุคูุฉ ููุณุชู ๐", callback_data=f"open_w_{whisper_id}")]])
    )

@app.on_message(filters.command(["ููุณู", "ููุณู ููุฏูุง"], "") & filters.reply & filters.group)
async def create_whisper(_, m: Message):
    sender, receiver = m.from_user, m.reply_to_message.from_user
    is_media = "ููุฏูุง" in m.text
    prompt = await m.reply_text(f"ุงุฑุณู ูุญุชูู ุงูููุณุฉ ูู {receiver.mention} ุงูุขู.. ๐ค๐ฅ")
    try:
        response = await app.listen(m.chat.id, sender.id, timeout=30)
        whisper_id = f"w_{m.id}"
        db["whispers"][whisper_id] = {"from": sender.id, "to": receiver.id, "msg": response.text if not is_media else "ููุฏูุง ๐ผ๏ธ", "media": response.id if is_media else None}
        await response.delete(); await prompt.delete()
        await m.reply_text(f"๐ค๐ฅ ููุณุฉ ูู {sender.mention} ูู {receiver.mention}", reply_markup=InlineKeyboardMarkup([[InlineKeyboardButton("ูุชุญ ุงูููุณุฉ ๐", callback_data=f"open_w_{whisper_id}")]]))
    except: await prompt.edit_text("ุงูุชูู ููุช ุงูููุณุฉุ ุญุงูู ูุฌุฏุฏุงู")

# --- [ 4. ูุนุงูุฌุฉ ุงูุงููุงูู ูุงูุฃุฒุฑุงุฑ ] ---

@app.on_callback_query(filters.regex(r"^open_w_"))
async def open_whisper_callback(_, q: CallbackQuery):
    w_id = q.data.replace("open_w_", ""); data = db["whispers"].get(w_id)
    if not data: return await q.answer("ุงูููุณุฉ ูุฏููุฉ ุฃู ุชู ูุณุญูุง โ", show_alert=True)
    if q.from_user.id in [data["from"], data["to"]]:
        if data.get("media"): await app.copy_message(q.from_user.id, q.message.chat.id, data["media"]); await q.answer("ุดูู ุนูู ุงูุฎุงุต ๐ค๐ฅ")
        else: await q.answer(f"๐ค๐ฅ: {data['msg']}", show_alert=True)
    else: await q.answer("ุงูููุณุฉ ููุณุช ูู ูุง ุฐูู! ๐โ", show_alert=True)

# --- [ 5. ูุนุงูุฌ ุงูุฑุฏูุฏ ุงูุฐูู ] ---

@app.on_message(filters.group & ~filters.me, group=10)
async def boda_auto_reply_watcher(_, m: Message):
    if not m.text or m.text.startswith((".", "/")): return
    text, user_id = m.text, m.from_user.id
    if user_id in db["personal"] and text in db["personal"][user_id]: await m.reply_text(db["personal"][user_id][text])
    elif text in db["special"]: await m.reply_text(f"โจ {db['special'][text]}")
    elif text in db["multi"]: await m.reply_text(random.choice(db["multi"][text]))
    elif text in db["replies"]: await m.reply_text(db["replies"][text])
